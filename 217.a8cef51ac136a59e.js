"use strict";(self.webpackChunksceiba_ui=self.webpackChunksceiba_ui||[]).push([[217],{8217:(y,S,s)=>{s.d(S,{Q:()=>K});var g=s(9862),a=s(5879),h=s(2651),_=s(3887),f=s(1922),p=s(6814),C=s(3814),o=s(2296),r=s(2596),m=s(617),d=s(5195),v=s(7700),x=s(1476),b=s(9038),E=s(1994),A=s(2066),M=s(9515);function U(i,c){if(1&i&&(a.TgZ(0,"mat-card-header")(1,"mat-card-title"),a._uU(2),a.ALo(3,"translate"),a.qZA()()),2&i){const e=a.oxw();a.xp6(2),a.hij("",a.lcZ(3,1,e.header)," ")}}function T(i,c){if(1&i){const e=a.EpF();a.TgZ(0,"seiba-ui-search-aggregations",7),a.NdJ("keySelect",function(n){a.CHM(e);const l=a.oxw();return a.KtG(l.aggrChange(n))})("moreKeys",function(n){a.CHM(e);const l=a.oxw();return a.KtG(l.moreKeyClick(n))}),a.qZA()}if(2&i){const e=a.oxw();a.Q6J("aggregations",e.sr.aggregations)("selectedAggr",e.aggrsSelection)}}function P(i,c){1&i&&(a.ynx(0),a._uU(1," | "),a.BQk())}function I(i,c){if(1&i&&(a.TgZ(0,"span",26),a._uU(1),a.YNc(2,P,2,0,"ng-container",1),a.qZA()),2&i){const e=c.$implicit,t=c.index,n=a.oxw(2).$implicit;a.xp6(1),a.AsE(" ",e.idtype,": ",e.value," "),a.xp6(1),a.Q6J("ngIf",t<n.metadata.identifiers.length-1)}}function L(i,c){if(1&i&&(a.TgZ(0,"div",23)(1,"span",24),a._uU(2,"Identificadores:"),a.qZA(),a.YNc(3,I,3,3,"span",25),a.qZA()),2&i){const e=a.oxw().$implicit;a.xp6(3),a.Q6J("ngForOf",e.metadata.identifiers)}}function z(i,c){if(1&i&&(a.TgZ(0,"mat-list-option",18)(1,"div",19)(2,"div",20),a._uU(3),a.qZA(),a.TgZ(4,"div",21),a._uU(5),a.qZA(),a.TgZ(6,"div",21),a._uU(7),a.qZA(),a.YNc(8,L,4,1,"div",22),a.qZA()()),2&i){const e=c.$implicit,t=a.oxw(3);a.Q6J("value",e.metadata)("selected",t.isSelected(e.metadata)),a.xp6(3),a.hij(" ",e.metadata.name," "),a.xp6(2),a.hij(" SceibaID: ",e.metadata.id," "),a.xp6(2),a.hij(" status: ",e.metadata.status," "),a.xp6(1),a.Q6J("ngIf",e.metadata.identifiers&&e.metadata.identifiers.length>0)}}function w(i,c){if(1&i){const e=a.EpF();a.TgZ(0,"mat-selection-list",16),a.NdJ("selectionChange",function(n){a.CHM(e);const l=a.oxw(2);return a.KtG(l.currentPageSelectionChange(n))}),a.YNc(1,z,9,6,"mat-list-option",17),a.qZA()}if(2&i){const e=a.oxw(2);a.Q6J("multiple",e.multipleSelection),a.xp6(1),a.Q6J("ngForOf",e.sr.hits.hits)}}function D(i,c){1&i&&(a.TgZ(0,"h2"),a._uU(1,"No hay resultados para su b\xfasqueda..."),a.qZA())}function Z(i,c){if(1&i){const e=a.EpF();a.TgZ(0,"div",8)(1,"div",9)(2,"button",10),a.NdJ("click",function(){a.CHM(e),a.oxw();const n=a.MAs(6);return a.KtG(n.toggle())}),a.TgZ(3,"mat-icon"),a._uU(4,"filter_list"),a.qZA()(),a.TgZ(5,"sceiba-ui-search-query-input",11),a.NdJ("queryChange",function(n){a.CHM(e);const l=a.oxw();return a.KtG(l.queryChange(n))}),a.qZA()(),a.TgZ(6,"mat-paginator",12),a.NdJ("page",function(n){a.CHM(e);const l=a.oxw();return a.KtG(l.pageChange(n))}),a.qZA(),a.YNc(7,w,2,2,"mat-selection-list",13),a.YNc(8,D,2,0,"ng-template",null,14,a.W1O),a.TgZ(10,"mat-paginator",15),a.NdJ("page",function(n){a.CHM(e);const l=a.oxw();return a.KtG(l.pageChange(n))}),a.qZA()()}if(2&i){const e=a.MAs(9),t=a.oxw();a.xp6(5),a.Q6J("query",t.query),a.xp6(1),a.Q6J("length",t.sr.hits.total)("pageSize",t.pageSize)("pageIndex",t.pageIndex),a.xp6(1),a.Q6J("ngIf",t.sr.hits&&t.sr.hits.hits.length>0)("ngIfElse",e),a.xp6(3),a.Q6J("length",t.sr.hits.total)("pageSize",t.pageSize)("pageIndex",t.pageIndex)("pageSizeOptions",t.pageSizeOptions)}}function B(i,c){if(1&i){const e=a.EpF();a.TgZ(0,"mat-card-actions",27)(1,"button",28),a.NdJ("click",function(){a.CHM(e);const n=a.oxw();return a.KtG(n.onNoClick())}),a._uU(2,"Cancel"),a.qZA(),a.TgZ(3,"button",29),a._uU(4," Ok "),a.qZA()()}if(2&i){const e=a.oxw();a.xp6(3),a.Q6J("mat-dialog-close",e.selectedOrgs)}}let K=(()=>{class i{constructor(e,t,n){this._env=e,this._cuorService=t,this._searchService=n,this.pageSize=5,this.pageIndex=0,this.pageSizeOptions=[5],this.query="",this.aggrsSelection={},this.loading=!0,this.selectedOrgs=[],this.selectedOrgEmiter=new a.vpe,this.multipleSelection=!1,this.showTitle=!0,this.filterCuban=!0,this.showActions=!0,this.header="SELECT_ORGANIZATION",this.env=this._env}ngOnInit(){this.query="",this.filterCuban&&(this.aggrsSelection.country=["Cuba"]),this.doSearch()}doSearch(){this.updateFetchParams(),this.fetchSearchRequest()}updateFetchParams(){if(this.params=new g.LE,this.params=this.params.set("size",this.pageSize.toString(10)),this.params=this.params.set("page",(this.pageIndex+1).toString(10)),this.params=this.params.set("q",this.query),this.filterCuban){for(const e in this.aggrsSelection)this.aggrsSelection[e].forEach(t=>{"country"!=e&&(this.params=this.params.set(e,t))});this.params=this.params.set("country","Cuba")}else for(const e in this.aggrsSelection)this.aggrsSelection[e].forEach(t=>{this.params=this.params.set(e,t)})}fetchSearchRequest(){this._cuorService.getOrganizations(this.params).subscribe({next:e=>{this.sr=e,this.aggr_keys=[{value:this.sr.aggregations.country,key:"Pa\xeds"},{value:this.sr.aggregations.state,key:"Provincia"},{value:this.sr.aggregations.status,key:"Estado"},{value:this.sr.aggregations.types,key:"Tipo"}],this.filterCuban&&(this.sr.aggregations.country.disabled=!0)},error:e=>{},complete:()=>{this.loading=!1}})}defaultPage(){this.pageSize=5,this.pageIndex=0}pageChange(e){this.pageSize=e.pageSize,this.pageIndex=e.pageIndex,this.doSearch()}aggrChange(e){this.aggrsSelection=e,this.defaultPage(),this.doSearch()}queryChange(e){this.query=e,this.defaultPage(),this.doSearch()}moreKeyClick(e){let t=this.sr.aggregations[e].buckets.length,l=[];for(const u in this.aggrsSelection)console.log(u),l.push({key:u,value:this.aggrsSelection[u]});console.log(l);let O={index:"organizations",filters:l,agg:{filter:e,size:t+5}};console.log(JSON.stringify(O)),this._searchService.getAggregationTerms(O).subscribe({next:u=>{u.status==_.Mxn.SUCCESS&&(this.sr.aggregations[e].buckets=u.data.terms)},error:u=>{},complete:()=>{}})}isSelected(e){return this.selectedOrgs.find(t=>t.id==e.id)}currentPageSelectionChange(e){let t=[];this.selectedOrgs.forEach(n=>{this.sr.hits.hits.find(l=>l.id==n.id)||t.push(n)}),e.source.selectedOptions.selected.forEach(n=>{t.push(n.value)}),this.selectedOrgs=t,this.selectedOrgEmiter.emit(this.selectedOrgs)}static#a=this.\u0275fac=function(t){return new(t||i)(a.Y36(_.qAh),a.Y36(f.Q),a.Y36(_.oDG))};static#e=this.\u0275cmp=a.Xpm({type:i,selectors:[["sceiba-ui-search-select-org"]],viewQuery:function(t,n){if(1&t&&a.Gf(h.jA,5),2&t){let l;a.iGM(l=a.CRH())&&(n.drawer=l.first)}},inputs:{multipleSelection:"multipleSelection",showTitle:"showTitle",filterCuban:"filterCuban",showActions:"showActions"},outputs:{selectedOrgEmiter:"selectedOrgEmiter"},decls:10,vars:5,consts:[[3,"loading"],[4,"ngIf"],["mode","side","closed","","position","start"],["drawer",""],[3,"aggregations","selectedAggr","keySelect","moreKeys",4,"ngIf"],["class","m-1",4,"ngIf"],["mat-dialog-actions","",4,"ngIf"],[3,"aggregations","selectedAggr","keySelect","moreKeys"],[1,"m-1"],["fxLayout","row nowrap","fxLayout.xs","column","fxLayoutAlign","space-between center"],["mat-icon-button","","matTooltip","Filtros avanzados",3,"click"],[1,"p-1",2,"width","100%",3,"query","queryChange"],[3,"length","pageSize","pageIndex","page"],[3,"multiple","selectionChange",4,"ngIf","ngIfElse"],["templateNotInfo",""],[3,"length","pageSize","pageIndex","pageSizeOptions","page"],[3,"multiple","selectionChange"],["style","margin: 1em 8px; display: flex; height: 200px",3,"value","selected",4,"ngFor","ngForOf"],[2,"margin","1em 8px","display","flex","height","200px",3,"value","selected"],["fxLayout","column",2,"padding","0px 16px","white-space","normal"],[1,"mat-headline-6"],["color","primary",1,"mat-caption"],["fxLayout","row wrap",4,"ngIf"],["fxLayout","row wrap"],[1,"mat-headline-8"],["class","li-margin-style mat-caption",4,"ngFor","ngForOf"],[1,"li-margin-style","mat-caption"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-raised-button","","color","primary",2,"margin-left","8px",3,"mat-dialog-close"]],template:function(t,n){1&t&&(a._UZ(0,"toco-progress",0),a.TgZ(1,"mat-card"),a.YNc(2,U,4,3,"mat-card-header",1),a.TgZ(3,"mat-card-content")(4,"mat-drawer-container")(5,"mat-drawer",2,3),a.YNc(7,T,1,2,"seiba-ui-search-aggregations",4),a.qZA(),a.YNc(8,Z,11,10,"div",5),a.qZA()(),a.YNc(9,B,5,1,"mat-card-actions",6),a.qZA()),2&t&&(a.Q6J("loading",n.loading),a.xp6(2),a.Q6J("ngIf",n.showTitle),a.xp6(5),a.Q6J("ngIf",n.sr),a.xp6(1),a.Q6J("ngIf",n.sr),a.xp6(1),a.Q6J("ngIf",n.showActions))},dependencies:[p.sg,p.O5,C.xw,C.Wh,o.lW,o.RK,r.gM,m.Hw,d.a8,d.hq,d.dn,d.dk,d.n5,v.ZT,v.H8,h.jA,h.kh,x.NW,b.Ub,b.vS,_.t15,E.Y,A.v,M.X$]})}return i})()},1922:(y,S,s)=>{s.d(S,{Q:()=>_});var g=s(9862),a=s(5879),h=s(3887);let _=(()=>{class p{constructor(o,r,m){this.http=o,this.handler=r,this.environment=m,this.prefix="organizations",this.httpOptions={headers:new g.WM({"Content-Type":"application/json",Authorization:"Bearer "})},this.iso639=[{label:"ab",value:"Abkhaz"},{label:"hy",value:"Armenio"},{label:"eu",value:"Vasco"},{label:"bg",value:"B\xfalgaro"},{label:"ca",value:"Catal\xe1n"},{label:"ce",value:"Chechenio"},{label:"ny",value:"Chichewa o Chewa o Nyanja"},{label:"zh",value:"Chino"},{label:"en",value:"Ingl\xe9s"},{label:"eo",value:"Esperanto"},{label:"es",value:"Espa\xf1ol (o Castellano)"},{label:"he",value:"Hebreo (moderno)"},{label:"hi",value:"Hindi"},{label:"la",value:"Latin"},{label:"no",value:"Noruego"},{label:"cu",value:"Antiguo eslavo eclesi\xe1stico o Iglesia eslava o eslavo eclesi\xe1stico o antiguo B\xfalgaro o Esclavo viejo"}],this.dpa=[{name:"Pinar del R\xedo",iso:"CU-01",dpa:"21",municipalities:[{dpa:"2101",name:"Sandino"},{dpa:"2102",name:"Mantua"},{dpa:"2103",name:"Minas de Matahambre"},{dpa:"2104",name:"Vi\xf1ales"},{dpa:"2105",name:"La Palma"},{dpa:"2106",name:"Los Palacios"},{dpa:"2107",name:"Consolaci\xf3n del Sur"},{dpa:"2108",name:"Pinar del R\xedo"},{dpa:"2109",name:"San Luis"},{dpa:"2110",name:"San Juan y Mart\xednez"},{dpa:"2111",name:"Guane"}]},{name:"Artemisa",iso:"CU-15",dpa:"22",municipalities:[{dpa:"2201",name:"Bah\xeda Honda"},{dpa:"2202",name:"Mariel"},{dpa:"2203",name:"Guanajay"},{dpa:"2204",name:"Caimito"},{dpa:"2205",name:"Bauta"},{dpa:"2206",name:"San Antonio de los Ba\xf1os"},{dpa:"2207",name:"G\xfcira de Melena"},{dpa:"2208",name:"Alqu\xedzar"},{dpa:"2209",name:"Artemisa"},{dpa:"2210",name:"Candelaria"},{dpa:"2211",name:"San Crist\xf3bal"}]},{name:"La Habana",iso:"CU-03",dpa:"23",municipalities:[{dpa:"2301",name:"Playa"},{dpa:"2302",name:"Plaza de la Revoluci\xf3n"},{dpa:"2303",name:"Centro Habana"},{dpa:"2304",name:"La Habana Vieja"},{dpa:"2305",name:"Regla"},{dpa:"2306",name:"Habana del Este"},{dpa:"2307",name:"Guanabacoa"},{dpa:"2308",name:"San Miguel del Padr\xf3n"},{dpa:"2309",name:"Diez de Octubre"},{dpa:"2310",name:"Cerro"},{dpa:"2311",name:"Marianao"},{dpa:"2312",name:"La Lisa"},{dpa:"2313",name:"Boyeros"},{dpa:"2314",name:"Arroyo Naranjo"},{dpa:"2315",name:"Cotorro"}]},{name:"Mayabeque",iso:"CU-16",dpa:"24",municipalities:[{dpa:"2401",name:"Bejucal"},{dpa:"2402",name:"San Jos\xe9 de Las Lajas"},{dpa:"2403",name:"Jaruco"},{dpa:"2404",name:"Santa Cruz del Norte"},{dpa:"2405",name:"Madruga"},{dpa:"2406",name:"Nueva Paz"},{dpa:"2407",name:"San Nicol\xe1s"},{dpa:"2408",name:"G\xfcines"},{dpa:"2409",name:"Melena del Sur"},{dpa:"2410",name:"Bataban\xf3"},{dpa:"2411",name:"Quivic\xe1n"}]},{name:"Matanzas",iso:"CU-04",dpa:"25",municipalities:[{dpa:"2501",name:"Matanzas"},{dpa:"2502",name:"C\xe1rdenas"},{dpa:"2503",name:"Mart\xed"},{dpa:"2504",name:"Col\xf3n"},{dpa:"2505",name:"Perico"},{dpa:"2506",name:"Jovellanos"},{dpa:"2507",name:"Pedro Betancourt"},{dpa:"2508",name:"Limonar"},{dpa:"2509",name:"Uni\xf3n de Reyes"},{dpa:"2510",name:"Ci\xe9naga de Zapata"},{dpa:"2511",name:"Jag\xfcey Grande"},{dpa:"2512",name:"Calimete"},{dpa:"2513",name:"Los Arabos"}]},{name:"Villa Clara",iso:"CU-05",dpa:"26",municipalities:[{dpa:"2601",name:"Corralillo"},{dpa:"2602",name:"Quemado de G\xfcines"},{dpa:"2603",name:"Sagua la Grande"},{dpa:"2604",name:"Encrucijada"},{dpa:"2605",name:"Camajuan\xed"},{dpa:"2606",name:"Caibari\xe9n"},{dpa:"2607",name:"Remedios"},{dpa:"2608",name:"Placetas"},{dpa:"2609",name:"Santa Clara"},{dpa:"2610",name:"Cifuentes"},{dpa:"2611",name:"Santo Domingo"},{dpa:"2612",name:"Ranchuelo"},{dpa:"2613",name:"Manicaragua"}]},{name:"Cienfuegos",iso:"CU-06",dpa:"27",municipalities:[{dpa:"2701",name:"Aguada de Pasajeros"},{dpa:"2702",name:"Rodas"},{dpa:"2703",name:"Palmira"},{dpa:"2704",name:"Lajas"},{dpa:"2705",name:"Cruces"},{dpa:"2706",name:"Cumanayagua"},{dpa:"2707",name:"Cienfuegos"},{dpa:"2708",name:"Abreus"}]},{name:"Sancti Sp\xedritus",iso:"CU-07",dpa:"28",municipalities:[{dpa:"2801",name:"Jaguajay"},{dpa:"2802",name:"Jatibonico"},{dpa:"2803",name:"Taguasco"},{dpa:"2804",name:"Cabaigu\xe1n"},{dpa:"2805",name:"Fomento"},{dpa:"2806",name:"Trinidad"},{dpa:"2807",name:"Sancti Spiritus"},{dpa:"2808",name:"La Sierpe"}]},{name:"Ciego de \xc1vila",iso:"CU-08",dpa:"29",municipalities:[{dpa:"2901",name:"Chambas"},{dpa:"2902",name:"Mor\xf3n"},{dpa:"2903",name:"Bolivia"},{dpa:"2904",name:"Primero de Enero"},{dpa:"2905",name:"Ciro Redondo"},{dpa:"2906",name:"Florencia"},{dpa:"2907",name:"Majagua"},{dpa:"2908",name:"Ciego de \xc1vila"},{dpa:"2909",name:"Venezuela"},{dpa:"2910",name:"Baragua"}]},{name:"Camag\xfcey",iso:"CU-09",dpa:"30",municipalities:[{dpa:"3001",name:"Carlos Manuel de C\xe9spedes"},{dpa:"3002",name:"Esmeralda"},{dpa:"3003",name:"Sierra de Cubitas"},{dpa:"3004",name:"Minas"},{dpa:"3005",name:"Nuevitas"},{dpa:"3006",name:"Gu\xe1imaro"},{dpa:"3007",name:"Sibanic\xfa"},{dpa:"3008",name:"Camag\xfcey"},{dpa:"3009",name:"Florida"},{dpa:"3010",name:"Vertientes"},{dpa:"3011",name:"Jimaguay\xfa"},{dpa:"3012",name:"Najasa"},{dpa:"3013",name:"Santa Cruz del Sur"}]},{name:"Las Tunas",iso:"CU-10",dpa:"31",municipalities:[{dpa:"3101",name:"Manat\xed"},{dpa:"3102",name:"Puerto Padre"},{dpa:"3103",name:"Jes\xfas Men\xe9ndez"},{dpa:"3104",name:"Majibacoa"},{dpa:"3105",name:"Las Tunas"},{dpa:"3106",name:"Jobabo"},{dpa:"3107",name:"Colombia"},{dpa:"3108",name:"Amancio"}]},{name:"Holgu\xedn",iso:"CU-11",dpa:"32",municipalities:[{dpa:"3201",name:"Gibara"},{dpa:"3202",name:"Rafael Freyre"},{dpa:"3203",name:"Banes"},{dpa:"3204",name:"Antilla"},{dpa:"3205",name:"Baguanos"},{dpa:"3206",name:"Holgu\xedn"},{dpa:"3207",name:"Calixto Garc\xeda"},{dpa:"3208",name:"Cacocum"},{dpa:"3209",name:"Urbano Noris"},{dpa:"3210",name:"Cueto"},{dpa:"3211",name:"Mayar\xed"},{dpa:"3212",name:"Franl Pa\xeds"},{dpa:"3213",name:"Sagua de T\xe1namo"},{dpa:"3214",name:"Moa"}]},{name:"Granma",iso:"CU-12",dpa:"33",municipalities:[{dpa:"3301",name:"R\xedo Cauto"},{dpa:"3302",name:"Cauto Cristo"},{dpa:"3303",name:"Jiguan\xed"},{dpa:"3304",name:"Bayamo"},{dpa:"3305",name:"Yara"},{dpa:"3306",name:"Manzanillo"},{dpa:"3307",name:"Campechuela"},{dpa:"3308",name:"Media Luna"},{dpa:"3309",name:"Niquero"},{dpa:"3310",name:"Pil\xf3n"},{dpa:"3311",name:"Bartolom\xe9 Mas\xf3"},{dpa:"3312",name:"Buey Arriba"},{dpa:"3313",name:"Guisa"}]},{name:"Santiago de Cuba",iso:"CU-13",dpa:"34",municipalities:[{dpa:"3401",name:"Contramaestre"},{dpa:"3402",name:"Mella"},{dpa:"3403",name:"San Luis"},{dpa:"3404",name:"Segundo Frente"},{dpa:"3405",name:"Songo - La Maya"},{dpa:"3406",name:"Santiago de Cuba"},{dpa:"3407",name:"Palma Soriano"},{dpa:"3408",name:"Tercer Frente"},{dpa:"3409",name:"Guam\xe1"}]},{name:"Guant\xe1namo",iso:"CU-14",dpa:"35",municipalities:[{dpa:"3501",name:"El Salvador"},{dpa:"3502",name:"Manuel Tames"},{dpa:"3503",name:"Yateras"},{dpa:"3504",name:"Baracoa"},{dpa:"3505",name:"Mais\xed"},{dpa:"3506",name:"Im\xedas"},{dpa:"3507",name:"San Antonio del Sur"},{dpa:"3508",name:"Caimanera"},{dpa:"3509",name:"Guant\xe1namo"},{dpa:"3510",name:"Niceto P\xe9rez"}]},{name:"Isla de la Juventud",iso:"CU-99",dpa:"4001"}],this.newHttp=new g.eN(r)}getISO639(){return this.iso639}getDPA(){return this.dpa}editOrganization(o){const r=o.entitystringify();console.log("payload",r),console.log("edit service org ",o);let d=this.http.post(this.environment.cuorApi+this.prefix+"/"+o.id+"/curate",r,this.httpOptions);return console.log("API response:",d),d}fileUpload(o){const r=this.environment.cuorHost+"import";return new g.WM({"Content-Type":"application/x-www-form-urlencoded"}),this.httpOptions.headers.set("Authorization","Bearer "+localStorage.getItem("access_token")),this.httpOptions.headers.set("Content-Type","application/x-www-form-urlencoded"),this.newHttp.post(r,o)}getOrganizations(o){return this.http.get(this.environment.sceibaApi+"search/organizations/",{params:o})}getActiveOrganizationById(o){return this.newHttp.get(this.environment.sceibaApi+"organizations/active/"+o)}getOrganizationById(o){return this.newHttp.get(this.environment.sceibaApi+"pid/organization/"+o)}static#a=this.\u0275fac=function(r){return new(r||p)(a.LFG(g.eN),a.LFG(g.jN),a.LFG(h.qAh))};static#e=this.\u0275prov=a.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()}}]);