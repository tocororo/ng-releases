"use strict";(self.webpackChunksceiba_ui=self.webpackChunksceiba_ui||[]).push([[797],{797:(Vt,w,c)=>{c.r(w),c.d(w,{PermissionsModule:()=>Wt});var u=c(6814),b=c(6223),d=c(3887),F=c(8341),S=c(2787),t=c(5879),I=c(1884),N=c(1274),P=c(4104),C=c(1476),Z=c(3566),l=c(5313),h=c(2296),f=c(617),x=c(2032),_=c(4170);const Q=["editorPaginator"],z=["editorSort"];function k(o,r){1&o&&(t.TgZ(0,"th",11),t._uU(1,"Nombre"),t.qZA())}function L(o,r){if(1&o&&(t.TgZ(0,"td",12),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.xp6(1),t.Oqu(e.name)}}function R(o,r){1&o&&(t.TgZ(0,"th",11),t._uU(1,"Estado"),t.qZA())}function H(o,r){1&o&&(t.TgZ(0,"mat-label"),t._uU(1,"P\xfablico"),t.qZA())}function G(o,r){1&o&&(t.TgZ(0,"mat-label"),t._uU(1,"En Revisi\xf3n"),t.qZA())}function $(o,r){if(1&o&&(t.TgZ(0,"td",12),t.YNc(1,H,2,0,"mat-label",13),t.YNc(2,G,2,0,"mat-label",13),t.qZA()),2&o){const e=r.$implicit;t.xp6(1),t.Q6J("ngIf","APPROVED"==e.source_status),t.xp6(1),t.Q6J("ngIf","APPROVED"!=e.source_status)}}function X(o,r){1&o&&(t.TgZ(0,"th",11),t._uU(1,"Acciones"),t.qZA())}const B=function(o,r){return[o,"sources",r,"view"]};function K(o,r){if(1&o&&(t.TgZ(0,"td",12)(1,"button",14)(2,"mat-icon"),t._uU(3,"edit"),t.qZA()()()),2&o){const e=r.$implicit,n=t.oxw();t.xp6(1),t.Q6J("routerLink",t.WLB(1,B,n.env.catalog,e.id))}}function j(o,r){1&o&&t._UZ(0,"tr",15)}function W(o,r){1&o&&t._UZ(0,"tr",16)}const V=function(){return{"width.%":"100"}},tt=function(){return[5,10,20]};let et=(()=>{class o{constructor(e){this.environment=e,this.displayedColumns=["name","source_status","actions"],this.editorDataSource=null,this.editorLength=0,this.loading=!0,this.env=this.environment}init(){this.editorDataSource=new l.by(this.asEditor),this.editorLength=this.asEditor.length,this.editorDataSource.paginator=this.editorPaginator,this.editorDataSource.sort=this.editorSort}ngOnInit(){this.init()}editorApplyFilter(e){this.editorDataSource.filter=e.trim().toLowerCase()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.qAh))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-mysources-editor"]],viewQuery:function(n,i){if(1&n&&(t.Gf(Q,7,C.NW),t.Gf(z,7,Z.YE)),2&n){let a;t.iGM(a=t.CRH())&&(i.editorPaginator=a.first),t.iGM(a=t.CRH())&&(i.editorSort=a.first)}},inputs:{asEditor:"asEditor"},decls:17,vars:8,consts:[["matInput","","placeholder","Buscar nombre",3,"keyup"],["mat-table","","matSort","",3,"dataSource","ngStyle"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","source_status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions","length"],["editorPaginator",""],["mat-header-cell",""],["mat-cell",""],[4,"ngIf"],["mat-icon-button","","aria-label","Editar",3,"routerLink"],["mat-header-row",""],["mat-row",""]],template:function(n,i){1&n&&(t.TgZ(0,"mat-form-field")(1,"input",0),t.NdJ("keyup",function(s){return i.editorApplyFilter(s.target.value)}),t.qZA()(),t.TgZ(2,"table",1),t.ynx(3,2),t.YNc(4,k,2,0,"th",3),t.YNc(5,L,2,1,"td",4),t.BQk(),t.ynx(6,5),t.YNc(7,R,2,0,"th",3),t.GkF(8),t.YNc(9,$,3,2,"td",4),t.BQk(),t.ynx(10,6),t.YNc(11,X,2,0,"th",3),t.YNc(12,K,4,4,"td",4),t.BQk(),t.YNc(13,j,1,0,"tr",7),t.YNc(14,W,1,0,"tr",8),t.qZA(),t._UZ(15,"mat-paginator",9,10)),2&n&&(t.xp6(2),t.Q6J("dataSource",i.editorDataSource)("ngStyle",t.DdM(6,V)),t.xp6(11),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",t.DdM(7,tt))("length",i.editorLength))},dependencies:[u.O5,u.PC,S.rH,h.RK,f.Hw,x.Nt,_.KE,_.hX,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,Z.YE,C.NW]})}return o})();var p=c(7700),y=c(2596),m=c(5195),v=c(2557),M=c(3305),T=c(9038),U=c(3680),E=c(4630);function ot(o,r){if(1&o&&(t.TgZ(0,"mat-option",5)(1,"span",6),t._uU(2),t.qZA()()),2&o){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.s9C("title",e.email),t.xp6(1),t.Oqu(e.email)}}const nt=function(){return{width:"100%"}};let A=(()=>{class o{constructor(e){this.userService=e,this.userCtrl=new b.p4,this.filteredUser=new Array,this.selectedUser=new t.vpe}ngOnInit(){this.userCtrl.valueChanges.subscribe({next:e=>{"string"==typeof e&&e.length>=3?this.userService.getUsers(10,1,e).subscribe({next:n=>{console.log(n.data.users),this.filteredUser=n.data.users}}):"object"==typeof e&&this.selectedUser.emit(e)}})}displayFn(e){return e?e.email:void 0}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.iw$))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-user-search"]],outputs:{selectedUser:"selectedUser"},decls:8,vars:6,consts:[["appearance","outline",3,"ngStyle"],["matInput","","placeholder","Correo Electr\xf3nico del Usuario","matTooltip","Escriba al menos las tres letras iniciales","aria-label","Buscar usuario",3,"matAutocomplete","formControl"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"title"]],template:function(n,i){if(1&n&&(t.TgZ(0,"mat-form-field",0)(1,"mat-label"),t._uU(2,"Usuario a qui\xe9n se le otorgar\xe1n los permisos"),t.qZA(),t._UZ(3,"input",1),t.TgZ(4,"mat-autocomplete",2,3),t.YNc(6,ot,3,3,"mat-option",4),t.qZA(),t._UZ(7,"mat-hint"),t.qZA()),2&n){const a=t.MAs(5);t.Q6J("ngStyle",t.DdM(5,nt)),t.xp6(3),t.Q6J("matAutocomplete",a)("formControl",i.userCtrl),t.xp6(1),t.Q6J("displayWith",i.displayFn),t.xp6(2),t.Q6J("ngForOf",i.filteredUser)}},dependencies:[u.sg,u.PC,y.gM,x.Nt,_.KE,_.hX,_.bx,U.ey,E.XC,E.ZL,b.Fj,b.JJ,b.oH]})}return o})();function it(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"mat-list-item"),t._uU(1),t.TgZ(2,"button",6),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.denyManager(a))}),t.TgZ(3,"mat-icon"),t._uU(4,"delete"),t.qZA()()()}if(2&o){const e=r.$implicit;t.xp6(1),t.hij(" ",e.email," ")}}function rt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"mat-list-item"),t._uU(1),t.TgZ(2,"button",6),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.denyEditor(a))}),t.TgZ(3,"mat-icon"),t._uU(4,"delete"),t.qZA()()()}if(2&o){const e=r.$implicit;t.xp6(1),t.hij(" ",e.email," ")}}function at(o,r){if(1&o&&(t.TgZ(0,"mat-chip"),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(e.user.email)}}function st(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.grantEditor())}),t._uU(1," Permiso Edicion "),t.qZA()}}function ct(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.grantManager())}),t._uU(1," Permiso Gestion "),t.qZA()}}let lt=(()=>{class o{constructor(e){this.sourceService=e,this.editors=new Array,this.managers=new Array,this.user=null}ngOnInit(){this.sourceService.permissionGetSourceEditors(this.source.id).subscribe(e=>{console.log(e),this.editors=e.data.permission.users},e=>{console.log("error: "+e+".")},()=>{console.log("complete")}),this.sourceService.permissionGetSourceManagers(this.source.id).subscribe(e=>{console.log(e),this.managers=e.data.permission.users},e=>{console.log("error: "+e+".")},()=>{console.log("complete")})}selectedUser(e){console.log(e),this.user=e}grantEditor(){this.sourceService.permissionSetSourceEditor(this.source.id,this.user.id,!0).subscribe(e=>{console.log(e),this.ngOnInit()},e=>{},()=>{}),this.user=null}grantManager(){console.log("save"),this.sourceService.permissionSetSourceManager(this.source.id,this.user.id,!0).subscribe(e=>{console.log(e),this.ngOnInit()},e=>{},()=>{}),this.user=null}denyManager(e){this.sourceService.permissionSetSourceManager(this.source.id,e.id,!1).subscribe(n=>{console.log(n),this.ngOnInit()},n=>{},()=>{})}denyEditor(e){this.sourceService.permissionSetSourceEditor(this.source.id,e.id,!1).subscribe(n=>{console.log(n),this.ngOnInit()},n=>{},()=>{})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.tkg))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-source-permission"]],inputs:{source:"source"},decls:25,vars:7,consts:[["aria-label","Asignando permisos a un usuario sobre una fuente"],[4,"ngFor","ngForOf"],[3,"selectedUser"],[4,"ngIf"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","aria-label","Eliminar","matTooltip","Eliminar",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),t._uU(3),t.qZA(),t.TgZ(4,"mat-card-subtitle"),t._uU(5),t.qZA(),t.TgZ(6,"mat-card-subtitle"),t._uU(7,"Permisos de edici\xf3n y gesti\xf3n"),t.qZA()(),t.TgZ(8,"mat-card-content")(9,"mat-accordion")(10,"mat-expansion-panel")(11,"mat-expansion-panel-header"),t._uU(12," Gestores "),t.qZA(),t.TgZ(13,"mat-list"),t.YNc(14,it,5,1,"mat-list-item",1),t.qZA()(),t.TgZ(15,"mat-expansion-panel")(16,"mat-expansion-panel-header"),t._uU(17," Editores "),t.qZA(),t.TgZ(18,"mat-list"),t.YNc(19,rt,5,1,"mat-list-item",1),t.qZA()()()(),t.TgZ(20,"mat-card-actions")(21,"catalog-user-search",2),t.NdJ("selectedUser",function(s){return i.selectedUser(s)}),t.qZA(),t.YNc(22,at,2,1,"mat-chip",3),t.YNc(23,st,2,0,"button",4),t.YNc(24,ct,2,0,"button",5),t.qZA()()),2&n&&(t.xp6(3),t.Oqu(i.source.name),t.xp6(2),t.Oqu(i.source.id),t.xp6(9),t.Q6J("ngForOf",i.managers),t.xp6(5),t.Q6J("ngForOf",i.editors),t.xp6(3),t.Q6J("ngIf",i.user),t.xp6(1),t.Q6J("ngIf",i.user),t.xp6(1),t.Q6J("ngIf",i.user))},dependencies:[u.sg,u.O5,h.lW,h.RK,y.gM,f.Hw,m.a8,m.hq,m.dn,m.dk,m.$j,m.n5,v.HS,M.pp,M.ib,M.yz,T.i$,T.Tg,A]})}return o})();const mt=["managerPaginator"],ut=["managerSort"];function dt(o,r){1&o&&(t.TgZ(0,"th",11),t._uU(1,"Nombre"),t.qZA())}function gt(o,r){if(1&o&&(t.TgZ(0,"td",12),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.xp6(1),t.Oqu(e.name)}}function pt(o,r){1&o&&(t.TgZ(0,"th",11),t._uU(1,"Estado"),t.qZA())}function ht(o,r){1&o&&(t.TgZ(0,"mat-label"),t._uU(1,"P\xfablico"),t.qZA())}function _t(o,r){1&o&&(t.TgZ(0,"mat-label"),t._uU(1,"En Revisi\xf3n"),t.qZA())}function ft(o,r){if(1&o&&(t.TgZ(0,"td",12),t.YNc(1,ht,2,0,"mat-label",13),t.YNc(2,_t,2,0,"mat-label",13),t.qZA()),2&o){const e=r.$implicit;t.xp6(1),t.Q6J("ngIf","APPROVED"==e.source_status),t.xp6(1),t.Q6J("ngIf","APPROVED"!=e.source_status)}}function yt(o,r){1&o&&(t.TgZ(0,"th",11),t._uU(1,"Acciones"),t.qZA())}const Tt=function(o,r){return[o,"sources",r,"view"]};function bt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"td",12)(1,"a",14)(2,"mat-icon"),t._uU(3,"edit"),t.qZA()(),t.TgZ(4,"button",15),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.openPermission(a))}),t.TgZ(5,"mat-icon"),t._uU(6,"vpn_key"),t.qZA()()()}if(2&o){const e=r.$implicit,n=t.oxw();t.xp6(1),t.Q6J("routerLink",t.WLB(1,Tt,n.env.catalog,e.id))}}function St(o,r){1&o&&t._UZ(0,"tr",16)}function Ct(o,r){1&o&&t._UZ(0,"tr",17)}const Zt=function(){return{"width.%":"100"}},xt=function(){return[5,10,20]};let vt=(()=>{class o{constructor(e,n){this.environment=e,this.dialog=n,this.displayedColumns=["name","source_status","actions"],this.managerDataSource=null,this.managerLength=0,this.loading=!0,this.env=this.environment}init(){this.managerDataSource=new l.by(this.asManager),this.managerLength=this.asManager.length,this.managerDataSource.paginator=this.managerPaginator,this.managerDataSource.sort=this.managerSort,console.log(this.managerPaginator,this.managerDataSource),this.loading=!1}ngOnInit(){this.init()}managerApplyFilter(e){this.managerDataSource.filter=e.trim().toLowerCase()}openPermission(e){this.dialog.open(Mt,{width:"80%",data:{source:e}})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.qAh),t.Y36(p.uw))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-mysources-manager"]],viewQuery:function(n,i){if(1&n&&(t.Gf(mt,7,C.NW),t.Gf(ut,7,Z.YE)),2&n){let a;t.iGM(a=t.CRH())&&(i.managerPaginator=a.first),t.iGM(a=t.CRH())&&(i.managerSort=a.first)}},inputs:{asManager:"asManager"},decls:16,vars:8,consts:[["matInput","","placeholder","Buscar nombre",3,"keyup"],["mat-table","","matSort","",3,"dataSource","ngStyle"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","source_status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions","length"],["managerPaginator",""],["mat-header-cell",""],["mat-cell",""],[4,"ngIf"],["mat-icon-button","","aria-label","Editar","matTooltip","Editar",3,"routerLink"],["mat-icon-button","","aria-label","Permisos","matTooltip","Permisos",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,i){1&n&&(t.TgZ(0,"mat-form-field")(1,"input",0),t.NdJ("keyup",function(s){return i.managerApplyFilter(s.target.value)}),t.qZA()(),t.TgZ(2,"table",1),t.ynx(3,2),t.YNc(4,dt,2,0,"th",3),t.YNc(5,gt,2,1,"td",4),t.BQk(),t.ynx(6,5),t.YNc(7,pt,2,0,"th",3),t.YNc(8,ft,3,2,"td",4),t.BQk(),t.ynx(9,6),t.YNc(10,yt,2,0,"th",3),t.YNc(11,bt,7,4,"td",4),t.BQk(),t.YNc(12,St,1,0,"tr",7),t.YNc(13,Ct,1,0,"tr",8),t.qZA(),t._UZ(14,"mat-paginator",9,10)),2&n&&(t.xp6(2),t.Q6J("dataSource",i.managerDataSource)("ngStyle",t.DdM(6,Zt)),t.xp6(10),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",t.DdM(7,xt))("length",i.managerLength))},dependencies:[u.O5,u.PC,S.rH,h.o6,h.RK,y.gM,f.Hw,x.Nt,_.KE,_.hX,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,Z.YE,C.NW]})}return o})(),Mt=(()=>{class o{constructor(e,n){this.dialogRef=e,this.data=n}ngOnInit(){this.source=this.data.source}onNoClick(){this.dialogRef.close()}ok(){}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(p.so),t.Y36(p.WI))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-mysources-manager-permissions"]],decls:2,vars:1,consts:[[1,"height-auto"],[3,"source"]],template:function(n,i){1&n&&(t.TgZ(0,"mat-dialog-content",0),t._UZ(1,"catalog-source-permission",1),t.qZA()),2&n&&(t.xp6(1),t.Q6J("source",i.source))},dependencies:[p.xY,lt],encapsulation:2})}return o})();function At(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"mat-list-item"),t._uU(1),t.TgZ(2,"button",5),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.denyManager(a))}),t.TgZ(3,"mat-icon"),t._uU(4,"delete"),t.qZA()()()}if(2&o){const e=r.$implicit;t.xp6(1),t.hij(" ",e.email," ")}}function wt(o,r){if(1&o&&(t.TgZ(0,"mat-chip"),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(e.user.email)}}function Nt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"button",6),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.grantManager())}),t._uU(1," Conceder Permiso "),t.qZA()}}let Pt=(()=>{class o{constructor(e){this.sourceService=e,this.managers=new Array,this.user=null}ngOnInit(){console.log(this.org),this.sourceService.permissionGetOrganizationManagers(this.org.id).subscribe(e=>{this.managers=e.data.permission.users},e=>{},()=>{})}selectedUser(e){this.user=e}grantManager(){this.sourceService.permissionSetOrganizationManager(this.org.id,this.user.id,!0).subscribe(e=>{this.ngOnInit()},e=>{},()=>{}),this.user=null}denyManager(e){this.sourceService.permissionSetOrganizationManager(this.org.id,e.id,!1).subscribe(n=>{this.ngOnInit()},n=>{},()=>{})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.tkg))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-organization-permission"]],inputs:{org:"org"},decls:15,vars:5,consts:[["aria-label","Asignando permisos a un usuario sobre una organizaci\xf3n"],[4,"ngFor","ngForOf"],[3,"selectedUser"],[4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","aria-label","Eliminar","matTooltip","Eliminar",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),t._uU(3),t.qZA(),t.TgZ(4,"mat-card-subtitle"),t._uU(5),t.qZA(),t.TgZ(6,"mat-card-subtitle"),t._uU(7,"Permisos gesti\xf3n sobre las fuentes clasificadas por esta organizaci\xf3n"),t.qZA()(),t.TgZ(8,"mat-card-content")(9,"mat-list"),t.YNc(10,At,5,1,"mat-list-item",1),t.qZA()(),t.TgZ(11,"mat-card-actions")(12,"catalog-user-search",2),t.NdJ("selectedUser",function(s){return i.selectedUser(s)}),t.qZA(),t.YNc(13,wt,2,1,"mat-chip",3),t.YNc(14,Nt,2,0,"button",4),t.qZA()()),2&n&&(t.xp6(3),t.Oqu(i.org.name),t.xp6(2),t.Oqu(i.org.id),t.xp6(5),t.Q6J("ngForOf",i.managers),t.xp6(3),t.Q6J("ngIf",i.user),t.xp6(1),t.Q6J("ngIf",i.user))},dependencies:[u.sg,u.O5,h.lW,h.RK,y.gM,f.Hw,m.a8,m.hq,m.dn,m.dk,m.$j,m.n5,v.HS,T.i$,T.Tg,A]})}return o})(),Ut=(()=>{class o{constructor(e,n){this.orgService=e,this.dialog=n,this.organizations=new Array,this.error=!1,this.getLevel=i=>i.level,this.isExpandable=i=>i.expandable,this.hasChild=(i,a)=>a.expandable}ngOnInit(){}openPermission(e){console.log(e),this.dialog.open(Et,{width:"80%",data:{org:e.item.metadata}})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.eY8),t.Y36(p.uw))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-mysources-organizations"]],inputs:{organizations:"organizations"},decls:1,vars:4,consts:[[3,"organizations","orgRelationshipType","iconAction","labelAction","action"]],template:function(n,i){1&n&&(t.TgZ(0,"toco-org-tree-viewer",0),t.NdJ("action",function(s){return i.openPermission(s)}),t.qZA()),2&n&&t.Q6J("organizations",i.organizations)("orgRelationshipType","child")("iconAction","vpn_key")("labelAction","Permisos")},dependencies:[d.eYL]})}return o})(),Et=(()=>{class o{constructor(e,n){this.dialogRef=e,this.data=n}ngOnInit(){this.org=this.data.org}onNoClick(){this.dialogRef.close()}ok(){}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(p.so),t.Y36(p.WI))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-mysources-organizations-permissions"]],decls:2,vars:1,consts:[[1,"height-auto"],[3,"org"]],template:function(n,i){1&n&&(t.TgZ(0,"mat-dialog-content",0),t._UZ(1,"catalog-organization-permission",1),t.qZA()),2&n&&(t.xp6(1),t.Q6J("org",i.org))},dependencies:[p.xY,Pt],encapsulation:2})}return o})();var O=c(1894),g=c(8445),D=c(2096);function Ot(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"mat-list-item"),t._uU(1),t.TgZ(2,"button",5),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.denyManager(a))}),t.TgZ(3,"mat-icon"),t._uU(4,"delete"),t.qZA()()()}if(2&o){const e=r.$implicit;t.xp6(1),t.hij(" ",e.email," ")}}function Dt(o,r){if(1&o&&(t.TgZ(0,"mat-chip"),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(e.user.email)}}function Jt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"button",6),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.grantManager())}),t._uU(1," Conceder Permiso "),t.qZA()}}let Yt=(()=>{class o{constructor(e){this.sourceService=e,this.managers=new Array,this.user=null}ngOnInit(){console.log(this.term),this.sourceService.permissionGetTermManagers(this.term.uuid).subscribe(e=>{this.managers=e.data.permission.users},e=>{},()=>{})}selectedUser(e){this.user=e}grantManager(){this.sourceService.permissionSetTermManager(this.term.uuid,this.user.id,!0).subscribe(e=>{this.ngOnInit()},e=>{},()=>{}),this.user=null}denyManager(e){this.sourceService.permissionSetTermManager(this.term.uuid,e.id,!1).subscribe(n=>{this.ngOnInit()},n=>{},()=>{})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.tkg))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-term-permission"]],inputs:{term:"term"},decls:15,vars:6,consts:[["aria-label","Asignando permisos a un usuario sobre un t\xe9rmino"],[4,"ngFor","ngForOf"],[3,"selectedUser"],[4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","aria-label","Eliminar","matTooltip","Eliminar",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),t._uU(3),t.qZA(),t.TgZ(4,"mat-card-subtitle"),t._uU(5),t.qZA(),t.TgZ(6,"mat-card-subtitle"),t._uU(7,"Permisos gesti\xf3n sobre las fuentes clasificadas por este t\xe9rmino"),t.qZA()(),t.TgZ(8,"mat-card-content")(9,"mat-list"),t.YNc(10,Ot,5,1,"mat-list-item",1),t.qZA()(),t.TgZ(11,"mat-card-actions")(12,"catalog-user-search",2),t.NdJ("selectedUser",function(s){return i.selectedUser(s)}),t.qZA(),t.YNc(13,Dt,2,1,"mat-chip",3),t.YNc(14,Jt,2,0,"button",4),t.qZA()()),2&n&&(t.xp6(3),t.AsE("",i.term.description," - [",i.term.identifier,"] "),t.xp6(2),t.Oqu(i.term.uuid),t.xp6(5),t.Q6J("ngForOf",i.managers),t.xp6(3),t.Q6J("ngIf",i.user),t.xp6(1),t.Q6J("ngIf",i.user))},dependencies:[u.sg,u.O5,h.lW,h.RK,y.gM,f.Hw,m.a8,m.hq,m.dn,m.dk,m.$j,m.n5,v.HS,T.i$,T.Tg,A]})}return o})();const J=function(){return{"white-space":"normal !important"}};function qt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"mat-tree-node",3)(1,"div",4),t._UZ(2,"button",5),t.TgZ(3,"mat-label"),t._uU(4),t.qZA(),t.TgZ(5,"button",6),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.openPermission(a))}),t.TgZ(6,"mat-icon"),t._uU(7,"vpn_key"),t.qZA()()()()}if(2&o){const e=r.$implicit;t.Q6J("ngStyle",t.DdM(2,J)),t.xp6(4),t.Oqu(e.name)}}function Ft(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"mat-tree-node",7)(1,"button",8)(2,"mat-icon",9),t._uU(3),t.qZA()(),t.TgZ(4,"div",10)(5,"mat-label"),t._uU(6),t.qZA(),t.TgZ(7,"button",6),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.openPermission(a))}),t.TgZ(8,"mat-icon"),t._uU(9,"vpn_key"),t.qZA()()()()}if(2&o){const e=r.$implicit,n=t.oxw();t.Q6J("ngStyle",t.DdM(4,J)),t.xp6(1),t.uIk("aria-label","toggle "+e.name),t.xp6(2),t.hij(" ",n.treeControl.isExpanded(e)?"expand_more":"chevron_right"," "),t.xp6(3),t.Oqu(e.name)}}let It=(()=>{class o{constructor(e,n){this.taxonomyService=e,this.dialog=n,this.treeFlattener=new g.JZ(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new O.C2(this.getLevel,this.isExpandable),this.dataSource=new g.kc(this.treeControl,this.treeFlattener)}ngOnInit(){if(this.data=new Array,this.terms){for(let e=0;e<this.terms.length;e++)this.taxonomyService.getTermByUUID(this.terms[e].uuid,10).subscribe(i=>{console.log(e,this.data),this.data.push(i.data.term_node),e==this.terms.length-1&&(this.dataSource.data=this.data,console.log(this.data))},i=>{},()=>{});this.terms.forEach(e=>{})}}transformer(e,n){return{name:e.term.description+" - ["+e.term.identifier+"]",term:e.term,level:n,expandable:e.children.length>0}}getLevel(e){return e.level}isExpandable(e){return e.expandable}hasChild(e,n){return n.expandable}getChildren(e){return(0,D.of)(e.children)}getParentNode(e){const n=this.getLevel(e);if(n<1)return null;for(let a=this.treeControl.dataNodes.indexOf(e)-1;a>=0;a--){const s=this.treeControl.dataNodes[a];if(this.getLevel(s)<n)return s}return null}openPermission(e){this.dialog.open(Y,{width:"80%",data:{term:e.term}})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.X4d),t.Y36(p.uw))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-mysources-terms"]],inputs:{terms:"terms"},decls:3,vars:3,consts:[[1,"scrolleable",3,"dataSource","treeControl"],["class","hover","matTreeNodeToggle","","matTreeNodePadding","","fxLayout","row","fxLayoutAlign","space-between center",3,"ngStyle",4,"matTreeNodeDef"],["class","hover","matTreeNodePadding","",3,"ngStyle",4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodeToggle","","matTreeNodePadding","","fxLayout","row","fxLayoutAlign","space-between center",1,"hover",3,"ngStyle"],["fxLayout","row","fxLayoutAlign","start center"],["mat-icon-button","","disabled",""],["mat-icon-button","","aria-label","Permisos","matTooltip","Permisos",3,"click"],["matTreeNodePadding","",1,"hover",3,"ngStyle"],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror"],["fxLayout","row","fxLayoutAlign","space-between center",1,"item-width"]],template:function(n,i){1&n&&(t.TgZ(0,"mat-tree",0),t.YNc(1,qt,8,3,"mat-tree-node",1),t.YNc(2,Ft,10,5,"mat-tree-node",2),t.qZA()),2&n&&(t.Q6J("dataSource",i.dataSource)("treeControl",i.treeControl),t.xp6(2),t.Q6J("matTreeNodeDefWhen",i.hasChild))},dependencies:[u.PC,h.RK,y.gM,f.Hw,_.hX,g.fQ,g.ah,g.eu,g.gi,g.uo]})}return o})(),Y=(()=>{class o{constructor(e,n){this.dialogRef=e,this.data=n}ngOnInit(){this.term=this.data.term}onNoClick(){this.dialogRef.close()}ok(){}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(p.so),t.Y36(p.WI))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-mysources-terms-permissions"]],decls:2,vars:1,consts:[[1,"height-auto"],[3,"term"]],template:function(n,i){1&n&&(t.TgZ(0,"mat-dialog-content",0),t._UZ(1,"catalog-term-permission",1),t.qZA()),2&n&&(t.xp6(1),t.Q6J("term",i.term))},dependencies:[p.xY,Yt],encapsulation:2})}return o})();var Qt=c(8525);function zt(o,r){if(1&o&&(t.TgZ(0,"mat-option",5),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.identifier),t.xp6(1),t.hij(" ",e.human_name," ")}}const q=function(){return{"white-space":"normal !important"}};function kt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"mat-tree-node",6)(1,"div",7),t._UZ(2,"button",8),t.TgZ(3,"mat-label"),t._uU(4),t.qZA(),t.TgZ(5,"button",9),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.openPermission(a))}),t.TgZ(6,"mat-icon"),t._uU(7,"vpn_key"),t.qZA()()()()}if(2&o){const e=r.$implicit;t.Q6J("ngStyle",t.DdM(2,q)),t.xp6(4),t.Oqu(e.name)}}function Lt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"mat-tree-node",10)(1,"button",11)(2,"mat-icon",12),t._uU(3),t.qZA()(),t.TgZ(4,"div",13)(5,"mat-label"),t._uU(6),t.qZA(),t.TgZ(7,"button",9),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.openPermission(a))}),t.TgZ(8,"mat-icon"),t._uU(9,"vpn_key"),t.qZA()()()()}if(2&o){const e=r.$implicit,n=t.oxw();t.Q6J("ngStyle",t.DdM(4,q)),t.xp6(1),t.uIk("aria-label","toggle "+e.name),t.xp6(2),t.hij(" ",n.treeControl.isExpanded(e)?"expand_more":"chevron_right"," "),t.xp6(3),t.Oqu(e.name)}}let Rt=(()=>{class o{constructor(e,n){this.taxonomyService=e,this.dialog=n,this.currentVocab="",this.treeFlattener=new g.JZ(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new O.C2(this.getLevel,this.isExpandable),this.dataSource=new g.kc(this.treeControl,this.treeFlattener)}ngOnInit(){this.taxonomyService.getVocabularies().subscribe(e=>{console.log(e),this.vocabularies=e.data.vocabularies},e=>{console.log(e)},()=>{})}onVocabularyChange(){this.taxonomyService.getTermsTreeByVocab(this.currentVocab).subscribe(e=>{console.log(e),this.dataSource.data=e.data.tree.term_node,this.data=e.data.tree.term_node},e=>{console.log(e)},()=>{})}remove_component(){}onChange(){console.log("ttree change")}transformer(e,n){return{name:e.term.description+" - ["+e.term.identifier+"]",term:e.term,level:n,expandable:e.children.length>0}}getLevel(e){return e.level}isExpandable(e){return e.expandable}hasChild(e,n){return n.expandable}getChildren(e){return(0,D.of)(e.children)}getParentNode(e){const n=this.getLevel(e);if(n<1)return null;for(let a=this.treeControl.dataNodes.indexOf(e)-1;a>=0;a--){const s=this.treeControl.dataNodes[a];if(this.getLevel(s)<n)return s}return null}openPermission(e){this.dialog.open(Y,{width:"80%",data:{term:e.term}})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.X4d),t.Y36(p.uw))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-mysources-terms-admin"]],decls:5,vars:5,consts:[["placeholder","Vocabularios","name","vocabularies",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[1,"scrolleable",3,"dataSource","treeControl"],["class","hover","matTreeNodeToggle","","matTreeNodePadding","","fxLayout","row","fxLayoutAlign","space-between center",3,"ngStyle",4,"matTreeNodeDef"],["class","hover","matTreeNodePadding","",3,"ngStyle",4,"matTreeNodeDef","matTreeNodeDefWhen"],[3,"value"],["matTreeNodeToggle","","matTreeNodePadding","","fxLayout","row","fxLayoutAlign","space-between center",1,"hover",3,"ngStyle"],["fxLayout","row","fxLayoutAlign","start center"],["mat-icon-button","","disabled",""],["mat-icon-button","","aria-label","Permisos","matTooltip","Permisos",3,"click"],["matTreeNodePadding","",1,"hover",3,"ngStyle"],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror"],["fxLayout","row","fxLayoutAlign","space-between center",1,"item-width"]],template:function(n,i){1&n&&(t.TgZ(0,"mat-select",0),t.NdJ("selectionChange",function(){return i.onVocabularyChange()})("valueChange",function(s){return i.currentVocab=s}),t.YNc(1,zt,2,2,"mat-option",1),t.qZA(),t.TgZ(2,"mat-tree",2),t.YNc(3,kt,8,3,"mat-tree-node",3),t.YNc(4,Lt,10,5,"mat-tree-node",4),t.qZA()),2&n&&(t.Q6J("value",i.currentVocab),t.xp6(1),t.Q6J("ngForOf",i.vocabularies),t.xp6(1),t.Q6J("dataSource",i.dataSource)("treeControl",i.treeControl),t.xp6(2),t.Q6J("matTreeNodeDefWhen",i.hasChild))},dependencies:[u.sg,u.PC,h.RK,y.gM,f.Hw,_.hX,Qt.gD,U.ey,g.fQ,g.ah,g.eu,g.gi,g.uo],styles:[".scrolleable[_ngcontent-%COMP%]{max-height:20em;min-width:15em;overflow:auto}"]})}return o})();function Ht(o,r){if(1&o&&(t.TgZ(0,"mat-tab",7)(1,"div",8),t._UZ(2,"catalog-mysources-editor",9),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("asEditor",e.asEditor)}}function Gt(o,r){if(1&o&&(t.TgZ(0,"mat-tab",10)(1,"div",8),t._UZ(2,"catalog-mysources-manager",11),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("asManager",e.asManager)}}function $t(o,r){1&o&&(t.TgZ(0,"mat-tab",12)(1,"div",8),t._UZ(2,"catalog-mysources-terms-admin"),t.qZA()())}function Xt(o,r){if(1&o&&(t.TgZ(0,"mat-tab",12)(1,"div",8),t._UZ(2,"catalog-mysources-terms",13),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("terms",e.terms)}}function Bt(o,r){if(1&o&&(t.TgZ(0,"mat-tab",14)(1,"div",8),t._UZ(2,"catalog-mysources-organizations",15),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("organizations",e.organizations)}}const Kt=[{path:"",component:(()=>{class o{constructor(e,n,i,a,s){this.sourceService=e,this.oauthStorage=n,this.environment=i,this.orgService=a,this.activatedRoute=s,this.isAdmin=!1,this.terms=new Array,this.loading=!0}init(e){this.asEditor=e.data.sources.editor,this.asManager=e.data.sources.manager,this.isAdmin=e.data.sources.admin,this.terms=e.data.sources.terms,this.organizations=e.data.sources.organizations,this.isAdmin&&this.activatedRoute.data.subscribe({next:n=>{n&&n.topOrganizationPID&&""!=n.topOrganizationPID&&this.orgService.getOrganizationByPID(n.topOrganizationPID).subscribe({next:i=>{this.organizations=[i]},error:i=>{},complete:()=>{}})},error:n=>{console.log(n)},complete:()=>{}}),this.loading=!1}ngOnInit(){this.sourceService.getMySourcesAllRoles().subscribe({next:e=>{console.log(e),localStorage.setItem("mysources",JSON.stringify(e)),this.loading=!1,this.init(e)},error:e=>{console.log("error: "+e+".")},complete:()=>{console.log("complete")}})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.tkg),t.Y36(I.Hy),t.Y36(d.qAh),t.Y36(d.eY8),t.Y36(S.gz))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["catalog-permissions"]],decls:12,vars:7,consts:[[1,"mat-elevation-z8","width-90","margin1em"],[3,"loading","position"],["fxLayout","row wrap","fxLayoutAlign","space-between center"],["label","Editor",4,"ngIf"],["label","Gestor",4,"ngIf"],["label","T\xe9rminos",4,"ngIf"],["label","Organizaciones",4,"ngIf"],["label","Editor"],[1,"mat-elevation-z8"],[3,"asEditor"],["label","Gestor"],[3,"asManager"],["label","T\xe9rminos"],[3,"terms"],["label","Organizaciones"],[3,"organizations"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0),t._UZ(1,"toco-progress",1),t.TgZ(2,"mat-toolbar")(3,"mat-toolbar-row",2)(4,"h1"),t._uU(5,"Mis Registros"),t.qZA()()(),t.TgZ(6,"mat-tab-group"),t.YNc(7,Ht,3,1,"mat-tab",3),t.YNc(8,Gt,3,1,"mat-tab",4),t.YNc(9,$t,3,0,"mat-tab",5),t.YNc(10,Xt,3,1,"mat-tab",5),t.YNc(11,Bt,3,1,"mat-tab",6),t.qZA()()),2&n&&(t.xp6(1),t.Q6J("loading",i.loading)("position","absolute"),t.xp6(6),t.Q6J("ngIf",i.asEditor&&i.asEditor.length>0),t.xp6(1),t.Q6J("ngIf",i.asManager&&i.asManager.length>0),t.xp6(1),t.Q6J("ngIf",i.isAdmin),t.xp6(1),t.Q6J("ngIf",!i.isAdmin&&i.terms&&i.terms.length>0),t.xp6(1),t.Q6J("ngIf",i.organizations&&i.organizations.length>0))},dependencies:[u.O5,N.Ye,N.rD,P.uX,P.SP,d.t15,et,vt,Ut,Rt,It]})}return o})()}];let jt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#o=this.\u0275inj=t.cJS({imports:[S.Bz.forChild(Kt),S.Bz]})}return o})(),Wt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#o=this.\u0275inj=t.cJS({imports:[u.ez,jt,F.m,d.IR2,d.TY2,d.nzq,b.UX]})}return o})()}}]);